{"version":3,"sources":["src/cell.js"],"names":[],"mappings":"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","file":"src/cell.js","sourcesContent":["Polymer('ms-cell', {\n  publish: {\n    cell: null,\n    revealed: {\n      value: false,\n      reflect: true\n    }\n  },\n  computedDisplayVal(flagged, revealed) {\n    if(flagged && !revealed) {\n      return 'F';\n    } else {\n      return this.cell.revealedVal();\n    }\n  },\n  computed: {\n    'hide'            : '!cell.flagged && !revealed',\n    'displayVal'      : 'computedDisplayVal(cell.flagged, revealed)'\n  },\n  ready() {\n    this.color = this.cell.color();\n    /**\n     * Recursively reveal a 0 risk cell's neighbors.\n     * And check for wins if revealing a risky cell.\n     */\n    let propagate = () => {\n      // only need to fire reveal-neighbors once\n      if(this.revealed && !this.cell.mine) {\n        this.removeEventListener('webkitAnimationEnd', propagate);\n        this.removeEventListener('MSAnimationEnd', propagate);\n        this.removeEventListener('animationend', propagate);\n        if(this.cell.risk === 0) {\n          this.fire('reveal-neighbors');\n        } else {\n          this.fire('check-win');\n        }\n      }\n    };\n    this.addEventListener('webkitAnimationEnd', propagate);\n    this.addEventListener('MSAnimationEnd', propagate);\n    this.addEventListener('animationend', propagate);\n  },\n  revealedChanged() {\n    if(this.revealed) {\n      this.cell.revealed = true;\n      this.setAttribute('class', this.cell.mine ? 'explode' : 'revealed');\n    }\n  },\n  reveal(event, detail, sender) {\n    // do nothing if it's already revealed or if it's been flagged.\n    if(this.revealed || this.cell.flagged) {\n      return;\n    }\n    this.revealed = true;\n    if(this.cell.mine) {\n      this.fire('explosion');\n    }\n  },\n  /**\n   * Event handler for context menu clicks (flagging mines)\n   */\n  flag(e) {\n    e.preventDefault();\n    if(this.revealed) {\n      return;\n    } else {\n      if(!this.cell.flagged) {\n        this.$.content.setAttribute('class', 'flagged drop-flag');\n        this.cell.flagged = true;\n        this.color = 'orange';\n        this.fire('flagged', 1);\n      } else {\n        let removeFlag = () => {\n          this.cell.flagged = false;\n          this.color = this.cell.color();\n          this.fire('flagged', -1);\n          this.$.content.setAttribute('class', '');\n          this.removeEventListener('webkitAnimationEnd', removeFlag);\n          this.removeEventListener('MSAnimationEnd', removeFlag);\n          this.removeEventListener('animationend', removeFlag);\n        };\n        this.addEventListener('webkitAnimationEnd', removeFlag);\n        this.addEventListener('MSAnimationEnd', removeFlag);\n        this.addEventListener('animationend', removeFlag);\n        /**\n         * Animate the flag pickup:\n         * Removing a class with animation (possible specific to reverse animation)\n         * and then adding a class with animation on different cycles (eventloops)\n         * seems to do the trick.\n         */\n        let content = this.$.content;\n        content.setAttribute('class', 'flagged');\n        setTimeout(() => {\n          content.setAttribute('class', 'flagged pickup-flag');\n        }, 0);\n      }\n    }\n  }\n});\n"]}